# Overview
This project is a member of [CommsChampion](https://github.com/arobenko/comms_champion)
ecosystem. It provides a code generator that produces C++11 code of a binary communication protocol,
defined using [CommsDSL](https://github.com/arobenko/CommsDSL-Specification) 
schema files. 

# What's Inside
- **commsdsl2comms** - A code generator, that produces C++11 code for binary
protocol definition out of [CommsDSL](https://github.com/arobenko/CommsDSL-Specification) 
schema files. The generated outcome is actually a CMake project that defines
a protocol using [COMMS library](https://github.com/arobenko/comms_champion#comms-library)
and C++11 programming language, as well as implements a protocol plugin for
the [CommsChampion Tools](https://github.com/arobenko/comms_champion#commschampion-tools).
For details on how to use the tool, please read the 
[commsdsl2comms Manual](https://github.com/arobenko/commsdsl/wiki/commsdsl2comms-Manual) wiki page.
- **libcommsdsl** - A C++11 library for parsing of 
[CommsDSL](https://github.com/arobenko/CommsDSL-Specification) schema files.
It can be used to implement independent code generators, which can produce
protocol definition code in other programming languages, bindings to the C++
classes generated by the **commsdsl2comms**, fuzzing testing, etc... 
NOTE, that at this moment, the library is not documented. Please
[get in touch](#contact-information) in case you need it. I'll let you know
when it's going to be ready.

# License
Code generated by **commsdsl2comms** has no license, the vendor is free to
pick one. <span style="color:red">**HOWEVER**</span>, the generated code
uses [COMMS library](https://github.com/arobenko/comms_champion#comms-library),
which is provided under **GPLv3 / Commercial** dual licensing scheme. Unless
commercial closed source license is obtained for the 
[COMMS library](https://github.com/arobenko/comms_champion#comms-library), the
generated code must remain open source and the picked license be compatible 
with **GPLv3**.

The code of this project (libraries and tools it contains) 
is licensed under [Apache v2.0](https://www.apache.org/licenses/LICENSE-2.0) license.

# Examples
There are multiple available examples of protocol definitions that use 
[CommsDSL](https://github.com/arobenko/CommsDSL-Specification) schema files
and **commsdsl2comms** code generator to generate relevant code.

#### Synthetic Demo Protocols
- [cc.demo1.commsdsl](https://github.com/arobenko/cc.demo1.commsdsl) - Demo 
protocol to demonstrate definition of various fields as well as simple protocol framing.
- [cc.demo2.commsdsl](https://github.com/arobenko/cc.demo2.commsdsl) - Demo 
protocol to demonstrate protocol versioning, where every message reports protocol
version in its transport frame.
- [cc.demo3.commsdsl](https://github.com/arobenko/cc.demo3.commsdsl) - Demo 
protocol to demonstrate protocol versioning, where one "connect" message reports protocol
version for all the subsequent messages.

#### Real Life Open Protocols
- [cc.mqtt311.commsdsl](https://github.com/arobenko/cc.mqtt311.commsdsl) - 
Defines [MQTT v3.1.1](http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.pdf)
protocol, where message ID shares
the same byte with extra flags, that may define existence of the fields in
message payload as well as influence how message needs to be processed. The protocol
definition also contains snippets of custom code that are injected by the
**commsdsl2comms** into the generated one.
- [cc.mqtt5.commsdsl](https://github.com/arobenko/cc.mqtt5.commsdsl) - 
Defines [MQTT v5](http://docs.oasis-open.org/mqtt/mqtt/v5.0/cs02/mqtt-v5.0-cs02.html) 
protocol. Similar to v3.1.1, but also adds a heterogeneous list of 
various properties.
- [cc.mqttsn.commsdsl](https://github.com/arobenko/cc.mqttsn.commsdsl) - 
Defines [MQTT-SN](http://mqtt.org/2013/12/mqtt-for-sensor-networks-mqtt-sn) 
protocol, where field of remaining length of the message can 
have either 1 or 3 bytes length, depending on the value it contains.
- [cc.ublox.commsdsl](https://github.com/arobenko/cc.ublox.commsdsl) - 
Defines **UBX** protocol used by various
[u-blox GPS receivers](https://www.u-blox.com/en/position-time). The protocol
itself is quite complex with hundreds of messages.

# How to Use Generated Code
The **commsdsl2comms** generates CMake project, which contains 
headers-only protocol definition library as well as code of protocol plugin 
for [CommsChampion Tools](https://github.com/arobenko/comms_champion#commschampion-tools).
Please open root CMakeLists.txt file and see available build options.

When built as "full solution" (**OPT_FULL_SOLUTION**  option is **ON**) on Windows system,
cmake generated **deploy_qt** build target, which invokes **deploy_qt** target of the
checked out and built [CommsChampion](https://github.com/arobenko/comms_champion) project. This
target will invoke **windeployqt.exe** utility from used Qt5 installation to deploy all 
relevant Qt5 libraries.
```
$> nmake deploy_qt5
```

The generated project also defines `doc_<protocol_name>` target which can be
used to build doxygen documentation of the protocol definition. The 
`<protocol_name>` portion of the build target is name of the protocol specified
in schema definition file(s).
```
$> make doc_demo1
```
**NOTE**, that the generated protocol code is mostly declarative statements
of classes and types definitions. It is self explanatory and easy to read.
In many cases it is easier to read and understand the generated code, than the
doxygen generated documentation. Please spend some time on browsing around
and looking at the generated code in addition to reading the generated documentation.

The generated code adheres to the implementation guidelines from the 
[COMMS library](https://github.com/arobenko/comms_champion#comms-library)'s
documentation. Please read **"How to Use Defined Custom Protocol"** page from
it for detailed explanation on how to use and/or compile-time configure the 
generated classes.

In case the generated code is incorrect or incomplete, please also read through
the **"How to Define New Custom Protocol"** page of 
[COMMS library](https://github.com/arobenko/comms_champion#comms-library)'s
documentation to understand how to implement missing portions. Also follow
the guidelines from [commsdsl2comms Manual](https://github.com/arobenko/commsdsl/wiki/commsdsl2comms-Manual)
on how to inject such custom code into the generated one.

# Versioning
This project will use [Semantic Versioning](https://semver.org/), where
**MAJOR** number will be equal to the latest **DSL** version 
(The first number of [CommsDSL](https://github.com/arobenko/CommsDSL-Specification)
version) it supports. The **MINOR** number will indicate various improvements
in the code of this repository, and **PATCH** number will indicate various bug fixes.

# How to Build
This project uses CMake as its build system. Please open main
[CMakeLists.txt](CMakeLists.txt) file and review available options as well as
mentioned available parameters, which can be used in addition to standard 
ones provided by CMake itself, to modify the default build. 

**NOTE**, that **libcommsdsl** uses [libxml2](http://xmlsoft.org)
to parse XML schema files, and **commsdsl2comms** uses [Boost](https://www.boost.org)
to parse its command line parameters (_Boost::program_options_),
perform filesystem operations (_Boost::filesystem_), and various string manipulation
algorithms. In case Boost libraries are not installed in expected default location
(mostly happens on Windows systems), use variables described in 
[CMake documentation](https://cmake.org/cmake/help/v3.8/module/FindBoost.html) 
to help CMake find required libraries and headers.
It is recommended to use `-DBoost_USE_STATIC_LIBS=ON` parameter to force
linkage with static Boost libraries.
Also on Windows systems there is no need to build [libxml2](http://xmlsoft.org) 
separately. The build process will check it out automatically and build static 
library itself. For example:

### Linux Build
```
$> cd /source/of/this/project
$> mkdir build && cd build
$> cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$PWD/install -DCOMMSDSL_NO_TESTS=ON ..
$> make install
```
### Windows Build
```
$> cd C:\source\of\this\project
$> mkdir build
$> cd build
$> cmake -G "NMake Makefiles" -DCMAKE_BUILD_TYPE=Release \ 
    -DCMAKE_INSTALL_PREFIX=%cd%/install -DCOMMSDSL_NO_TESTS=ON \
    -DBOOST_ROOT="C:\Libraries\boost_1_65_1" -DBoost_USE_STATIC_LIBS=ON ..
$> nmake install
```

# Branching Model
This repository will follow the 
[Successful Git Branching Model](http://nvie.com/posts/a-successful-git-branching-model/).

The **master** branch will always point to the latest release, the
development is performed on **develop** branch. As the result it is safe
to just clone the sources of this repository and use it without
any extra manipulations of looking for the latest stable version among the tags and
checking it out.

# Contact Information
For bug reports, feature requests, or any other question you may open an issue
here in **github** or e-mail me directly to: **arobenko@gmail.com**. I usually
respond within 24 hours.

